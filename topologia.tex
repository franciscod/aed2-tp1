\begin{tadx}{\tadNombre{Topología}}{
	\noindent Este TAD modela cómo se conectan las computadoras.
	Las IP son únicas entre compus de la topología.
	Las compus tienen interfaces numeradas con los naturales de manera consecutiva
	(todas funcionan perfecto y todo eso, el DC las cuida y mantiene como corresponde).
	}
	\tadGeneros{topologia}
	% TODO: exporta?
	%\tadIgualdadObservacional{t}{t'}{topo}{$compus(t) \igobs compus(t')\ \yluego$\\ $(\neg(n=0?) \impluego (\text{pred}(n) \igobs \text{pred}(m)))$}
	\tadAlinearFunciones{interfacesOcupadasDe}{topologia, conj(nat), nat, conj(nat), secu(nat)	}
	\tadGeneradores
	\tadOperacion{NuevaTopo}{}{topologia}{}
	\tadOperacion{Compu}{topologia, nat/ip, nat}{topologia}{$\neg(ip \in compus(t))$}
	\tadOperacion{Cable}{topologia, nat/ipA, nat/ifA, nat/ipB, nat/ifB}{topologia}{
		$(ipA \in compus(t) \land ipB \in compus(t)) \yluego$ \\
		$(ifA < \#interfaces(t, ipA)) \land$ \\
		$(ifB < \#interfaces(t, ipB)) \land$ \\
		$\neg(ifA \in interfacesOcupadasDe(t, ipA)) \land$ \\
		$\neg(ifB \in interfacesOcupadasDe(t, ipB)) \land$ \\
		$\neg(ipA \in vecinas(t, ipB))$
	}
	\tadObservadores

	\tadOperacion{compus}{topologia}{conj(nat)}{}
	\tadOperacion{cablesEn}{topologia/t, nat/ip}{conj(tupla(nat, nat))}{$ip \in compus(t)$}
	\tadOperacion{\#interfaces}{topologia/t, nat/ip}{nat}{$ip \in compus(t)$}

	\tadOtrasOperaciones

	\tadOperacion{vecinas}{topologia/t, nat/ip}{conj(nat)}{$ip \in compus(t)$}
	\tadOperacion{interfacesOcupadasDe}{topologia/t, nat/ip}{conj(nat)}{$ip \in compus(t)$}
	\tadOperacion{conectados?}{topologia/t, nat/ipA, nat/ipB}{bool}{$ipA \in compus(t) $ $\land$ $ipB \in compus(t)$}
	\tadOperacion{darCaminoMasCorto}{topologia/t, nat/a, nat/b}{secu(nat)}{$conectados?(t, a, b)$}
	\tadOperacion{darRutas}{topologia, nat, nat, conj(nat), secu(nat)}{conj(secu(nat))}{}
	\tadOperacion{darRutasVecinas}{topologia, conj(nat), nat, conj(nat), secu(nat)}{conj(secu(nat))}{}
	\tadOperacion{longMenorSec}{conj(secu($\alpha$))}{nat}{}
	\tadOperacion{secusDeLongK}{conj(secu($\alpha$)), nat}{conj(secu($\alpha$))}{}
	\tadOperacion{map$\Pi_1$}{conj(tupla(nat, nat))}{conj(nat))}{}
	\tadOperacion{map$\Pi_2$}{conj(tupla(nat, nat))}{conj(nat))}{}

	\tadAlinearAxiomas{cablesEn(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}

	\tadAxiomas[
	\paratodo{topologia}{t},
	\paratodo{nat}{ipNueva, ip, ipA, ipB, ifA, ifB, cantIfaces, k},
	\paratodo{conj(tupla(nat, nat))}{conjDuplas},
	\paratodo{conj(nat)}{cs, rec, vecinas},
	\paratodo{conj(secu($\alpha$))}{secus},
	\paratodo{conj(secu($\alpha$))}{sc},
	\paratodo{secu(nat)}{ruta}
	]


	\tadAxioma{compus(NuevaTopo)}{$\emptyset$}
	\tadAxioma{compus(Compu($t$, $ipNueva$, $cantIfaces$))}{Ag($ipNueva$, compus($t$))}
	\tadAxioma{compus(Cable($t$, $ipA$, $ifA$, $ipB$, $ifB$))}{compus($t$)}
	\tadAxioma{cablesEn(NuevaTopo, $ip$)}{$\emptyset$}
	\tadAxioma{cablesEn(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}{cablesEn($t$, $ip$)}
	\tadAxioma{cablesEn(Cable($t$, $ipA$, $ifA$, $ipB$, $ifB$), $ip$)}{
	\IF $ip$ = $ipA$ THEN Ag($\langle$ $ifA$, $ipB$ $\rangle$, $\emptyset$) ELSE $\emptyset$ FI $\cup$ \\
	\IF $ip$ = $ipB$ THEN Ag($\langle$ $ifB$, $ipA$ $\rangle$, $\emptyset$) ELSE $\emptyset$ FI $\cup$ \\
	cablesEn($t$, $ip$)
	}

	\tadAlinearAxiomas{\#interfaces(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}

	\tadAxioma{\#interfaces(NuevaTopo, $ip$)}{0}
	\tadAxioma{\#interfaces(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}{\IF $ip$ = $ipNueva$ THEN $cantIfaces$ ELSE \#interfaces($t$) FI}
	\tadAxioma{\#interfaces(Cable($t$, $ipA$, $ifA$, $ipB$, $ifB$), $ip$)}{\#interfaces($t$)}
	\tadAlinearAxiomas{darRutasVecinas($t$, $vecinas$, $ipB$, $rec$, $ruta$)}
	\tadAxioma{interfacesOcupadasDe($t$, $ip$)}{map$\Pi_1$(cablesEn($t$, $ip$))}
	\tadAxioma{vecinas($t$, $ip$)}{map$\Pi_2$(cablesEn($t$, $ip$))}
	\tadAxioma{conectados?($t$, $ipA$, $ipB$)}{
		$\neg$ $\emptyset$?(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>))
	}

	\tadAxioma{darRutas($t$, $ipA$, $ipB$, $rec$, $ruta$)}{
		\IF $ipB$ $\in$ vecinas($t$, $ipA$) THEN
			Ag($ruta$ \& ($ipA$ \puntito $ipB$ \puntito <>), $\emptyset$)
		ELSE{
			\IF $\emptyset$?(vecinas($t$, $ipA$) - $rec$) THEN
				$\emptyset$
			ELSE
				darRutas($t$, dameUno(vecinas($t$, $ipA$) - $rec$), $ipB$, Ag($ipA$, $rec$), $ruta$ \circulito $ipA$) $\cup$ \\
				darRutasVecinas($t$, sinUno(vecinas($t$, $ipA$) - $rec$), $ipB$, Ag($ipA$, $rec$), $ruta$ \circulito $ipA$)
			FI
		}
		FI
	}

	\tadAxioma{darRutasVecinas($t$, $vecinas$, $ipB$, $rec$, $ruta$)}{
		\IF $\emptyset$?($vecinas$) THEN
			$\emptyset$
		ELSE
			darRutas($t$, dameUno($vecinas$), $ipB$, $rec$, $ruta$) $\cup$
			darRutasVecinas($t$, sinUno($vecinas$), $ipB$, $rec$, $ruta$)
		FI
	}

	\tadAxioma{darCaminoMasCorto($t$, $ipA$, $ipB$)}{dameUno(secusDeLongK(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>), longMenorSec(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>)))}

	\tadAxioma{secusDeLongK($secus$, $k$)}{
		\IF $\emptyset$?($secus$) THEN
			$\emptyset$
		ELSE{
			\IF long(dameUno($secus$)) = $k$ THEN
				dameUno($secus$) $\cup$ secusDeLongK(sinUno($secus$), $k$)
			ELSE
				secusDeLongK(sinUno($secus$), $k$)
			FI
		}
		FI
	}

	\tadAxioma{longMenorSec($secus$)}{
		\IF $\emptyset$?($secus$) THEN
			0
		ELSE
			min(long(dameUno($secus$)), longMenorSec(sinUno($secus$)))
		FI
	}

	\tadAxioma{map$\Pi_1$($conjDuplas$)}{
		\IF $\emptyset$?($conjDuplas$) THEN
			$\emptyset$
		ELSE
			Ag($\pi_1$(dameUno($conjDuplas$)), map$\Pi_1$(sinUno($conjDuplas$)))
		FI
	}
	\tadAxioma{map$\Pi_2$($conjDuplas$)}{
		\IF $\emptyset$?($conjDuplas$) THEN
			$\emptyset$
		ELSE
			Ag($\pi_2$(dameUno($conjDuplas$)), map$\Pi_2$(sinUno($conjDuplas$)))
		FI
	}
\end{tadx}
