\begin{tadx}{\tadNombre{Topología}}{
	\noindent Este TAD modela cómo se conectan las computadoras.
	Las IP son únicas entre compus de la topología.
	Las compus tienen interfaces numeradas con los naturales de manera consecutiva
	(todas funcionan perfecto y todo eso, el DC las cuida y mantiene como corresponde).
	}
	\tadGeneros{topologia}
	% TODO: exporta?
	%\tadIgualdadObservacional{t}{t'}{topo}{$compus(t) \igobs compus(t')\ \yluego$\\ $(\neg(n=0?) \impluego (\text{pred}(n) \igobs \text{pred}(m)))$}
	\tadAlinearFunciones{interfacesOcupadasDe}{topologia, conj(nat), nat, conj(nat), secu(nat)	}
	\tadGeneradores
	\tadOperacion{NuevaTopo}{}{topologia}{}
	\tadOperacion{Compu}{topologia, nat/ip, nat}{topologia}{$\neg(ip \in compus(t))$}
	\tadOperacion{Cable}{topologia, nat/ipA, nat/ifA, nat/ipB, nat/ifB}{topologia}{
		$(ipA \in compus(t) \land ipB \in compus(t)) \yluego$ \\
		$(ifA < \#interfaces(t, ipA)) \land$ \\
		$(ifB < \#interfaces(t, ipB)) \land$ \\
		$\neg(ifA \in interfacesOcupadasDe(t, ipA)) \land$ \\
		$\neg(ifB \in interfacesOcupadasDe(t, ipB)) \land$ \\
		$\neg(ipA \in vecinas(t, ipB))$
	}
	\tadObservadores

	\tadOperacion{compus}{topologia}{conj(nat)}{}
	\tadOperacion{cablesEn}{topologia/t, nat/ip}{conj(tupla(nat, nat))}{$ip \in compus(t)$}
	\tadOperacion{\#interfaces}{topologia/t, nat/ip}{nat}{$ip \in compus(t)$}

	\tadOtrasOperaciones

	\tadOperacion{vecinas}{topologia/t, nat/ip}{conj(nat)}{$ip \in compus(t)$}
	\tadOperacion{interfacesOcupadasDe}{topologia/t, nat/ip}{conj(nat)}{$ip \in compus(t)$}
	\tadOperacion{conectados?}{topologia/t, nat/ipA, nat/ipB}{bool}{$ipA \in compus(t) $ $\land$ $ipB \in compus(t)$}
        \tadOperacion{darInterfazConectada}{{conj(tupla(nat, nat))}/cablesA, nat/ipB}{nat}{$ipB \in \pi_2Conj(cablesA)$}
        \tadOperacion{darSegmento}{topologia/t, nat/ipA, nat/ipB}{segmento}{$ipA \in compus(t) \yluego ipB \in vecinas(t, ipA)$}
        \tadOperacion{estáEnRuta?}{secu(segmento)/ruta, nat/ip}{bool}{} 
        \tadOperacion{darSiguientePc}{secu(segmento)/ruta, nat/ip}{nat}{$est\acute{a}EnRuta?(ruta, ip)$} 
	\tadOperacion{darCaminoMasCorto}{topologia/t, nat/ipA, nat/ipB}{secu(segmento)}{$ipA \in compus(t)$ $\land$ $ipB \in compus(t)$ $\yluego conectados?(t, ipA, ipB)$}
	\tadOperacion{darRutas}{topologia, nat/ipA, nat/ipB, conj(nat), {secu(segmento))}}{conj(secu(segmento)))}{$ipA \in compus(t) \land ipB \in compus(t)$}
	\tadOperacion{darRutasVecinas}{topologia, conj(nat), nat/ip, conj(nat), secu(segmento)}{conj(secu(segmento))}{$ip \in compus(t)$}
	\tadOperacion{longMenorSec}{conj(secu($\alpha$))}{nat}{}
	\tadOperacion{secusDeLongK}{conj(secu($\alpha$)), nat}{conj(secu($\alpha$))}{}
	\tadOperacion{$\pi_1$Conj}{{conj(tupla(nat, nat))}}{conj(nat))}{}
	\tadOperacion{$\pi_2$Conj}{{conj(tupla(nat, nat))}}{conj(nat))}{}

	\tadAlinearAxiomas{cablesEn(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}

	\tadAxiomas[
	\paratodo{topologia}{t},
	\paratodo{nat}{ipNueva, ip, ipA, ipB, ifA, ifB, cantIfaces, k},
	\paratodo{conj(tupla(nat, nat))}{conjDuplas},
	\paratodo{conj(tupla(nat, nat))}{conjCablesIpA},
        \paratodo{conj(nat)}{cs, rec, vecinas},
	\paratodo{conj(secu($\alpha$))}{secus},
	\paratodo{conj(secu($\alpha$))}{sc},
	\paratodo{secu(segmento)}{ruta}
	]


	\tadAxioma{compus(NuevaTopo)}{$\emptyset$}
	\tadAxioma{compus(Compu($t$, $ipNueva$, $cantIfaces$))}{Ag($ipNueva$, compus($t$))}
	\tadAxioma{compus(Cable($t$, $ipA$, $ifA$, $ipB$, $ifB$))}{compus($t$)}
	\tadAxioma{cablesEn(NuevaTopo, $ip$)}{$\emptyset$}
	\tadAxioma{cablesEn(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}{cablesEn($t$, $ip$)}
	\tadAxioma{cablesEn(Cable($t$, $ipA$, $ifA$, $ipB$, $ifB$), $ip$)}{
	\IF $ip$ = $ipA$ THEN Ag($\langle$ $ifA$, $ipB$ $\rangle$, $\emptyset$) ELSE $\emptyset$ FI $\cup$ \\
	\IF $ip$ = $ipB$ THEN Ag($\langle$ $ifB$, $ipA$ $\rangle$, $\emptyset$) ELSE $\emptyset$ FI $\cup$ \\
	cablesEn($t$, $ip$)
	}

	\tadAlinearAxiomas{\#interfaces(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}

	\tadAxioma{\#interfaces(NuevaTopo, $ip$)}{0}
	\tadAxioma{\#interfaces(Compu($t$, $ipNueva$, $cantIfaces$), $ip$)}{\IF $ip$ = $ipNueva$ THEN $cantIfaces$ ELSE \#interfaces($t$) FI}
	\tadAxioma{\#interfaces(Cable($t$, $ipA$, $ifA$, $ipB$, $ifB$), $ip$)}{\#interfaces($t$)}
	\tadAxioma{interfacesOcupadasDe($t$, $ip$)}{$\pi_1$Conj(cablesEn($t$, $ip$))}
	\tadAxioma{vecinas($t$, $ip$)}{$\pi_2$Conj(cablesEn($t$, $ip$))}
	\tadAxioma{conectados?($t$, $ipA$, $ipB$)}{
		$\neg$ $\emptyset$?(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>))
	}
        \tadAxioma{darInterfazConectada($conjCablesIpA$, $ipB$)}{
            \IF $ipB$ = $\pi_2$(dameUno($conjCablesIpA$)) THEN $\pi_1$(dameUno($conjCablesIpA$)) ELSE darInterfazConectada(sinUno($conjCablesIpA$), $ipB$) FI
        }
        \tadAxioma{darSegmento($t$, $ipA$, $ipB$)}{
            <$ipA$, darInterfazConectada(cablesEn($t$, $ipA$), $ipB$), \\ $ipB$, darInterfazConectada(cablesEn($t$, $ipB$), $ipA$)>
        }
        \tadAxioma{estáEnRuta?($ruta$, $ip$)}{
                    \IF vacía?($ruta$) THEN
                        false
                    ELSE{
                        \IF $\pi_1$(prim($ruta$))=$ip$ THEN
                            true
                        ELSE
                            estáEnRuta?(fin($rutas$), $ip$)
                        FI
                        }
                    FI 
        }
	\tadAxioma{darSiguientePc($ruta$, $ip$)}{
                    \IF $\pi_1$(prim($ruta$))=$ip$ THEN
                        $\pi_3$(prim($ruta$))
                    ELSE
                        darSiguientePc(fin($rutas$), $ip$)
                    FI
            } 
        
        \tadAxioma{darCaminoMasCorto($t$, $ipA$, $ipB$)}{dameUno(secusDeLongK(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>), longMenorSec(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>)))}
	
        \tadAlinearAxiomas{darRutas($t$, $ipA$, $ipB$, $rec$, $ruta$)}

	\tadAxioma{darRutas($t$, $ipA$, $ipB$, $rec$, $ruta$)}{
		\IF $ipB$ $\in$ vecinas($t$, $ipA$) THEN
			Ag($ruta$ \circulito darSegmento($t$, $ipA$, $ipB$) , $\emptyset$)
		ELSE{
			\IF $\emptyset$?(vecinas($t$, $ipA$) - $rec$) THEN
				$\emptyset$
			ELSE
				darRutas($t$, dameUno(vecinas($t$, $ipA$) - $rec$), \\ $ipB$, Ag($ipA$, $rec$),\\
                                $ruta$ \circulito darSegmento($t$, $ipA$, dameUno(vecinas($t$, $ipA$) - $rec$))) $\cup$ \\
				darRutasVecinas($t$, sinUno(vecinas($t$, $ipA$) - $rec$), \\ $ipB$, Ag($ipA$, $rec$), \\
                                $ruta$ \circulito darSegmento($t$, $ipA$, dameUno(vecinas($t$, $ipA$) - $rec$))) 
			FI
		}
		FI
	}

	\tadAlinearAxiomas{darRutasVecinas($t$, $vecinas$, $ipB$, $rec$, $ruta$)}
	\tadAxioma{darRutasVecinas($t$, $vecinas$, $ipB$, $rec$, $ruta$)}{
		\IF $\emptyset$?($vecinas$) THEN
			$\emptyset$
		ELSE
			darRutas($t$, dameUno($vecinas$), $ipB$, $rec$, $ruta$) $\cup$ \\
			darRutasVecinas($t$, sinUno($vecinas$), $ipB$, $rec$, $ruta$)
		FI
	}

	\tadAxioma{darCaminoMasCorto($t$, $ipA$, $ipB$)}{dameUno(secusDeLongK(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>), longMenorSec(darRutas($t$, $ipA$, $ipB$, $\emptyset$, <>)))}

	\tadAxioma{secusDeLongK($secus$, $k$)}{
		\IF $\emptyset$?($secus$) THEN
			$\emptyset$
		ELSE{
			\IF long(dameUno($secus$)) = $k$ THEN
				dameUno($secus$) $\cup$ secusDeLongK(sinUno($secus$), $k$)
			ELSE
				secusDeLongK(sinUno($secus$), $k$)
			FI
		}
		FI
	}

	\tadAxioma{longMenorSec($secus$)}{
		\IF $\emptyset$?($secus$) THEN
			0
		ELSE
			min(long(dameUno($secus$)), longMenorSec(sinUno($secus$)))
		FI
	}

	\tadAxioma{$\pi_1$Conj($conjDuplas$)}{
		\IF $\emptyset$?($conjDuplas$) THEN
			$\emptyset$
		ELSE
			Ag($\pi_1$(dameUno($conjDuplas$)), $\pi_1$Conj(sinUno($conjDuplas$)))
		FI
	}
	\tadAxioma{$\pi_2$Conj($conjDuplas$)}{
		\IF $\emptyset$?($conjDuplas$) THEN
			$\emptyset$
		ELSE
			Ag($\pi_2$(dameUno($conjDuplas$)), $\pi_2$Conj(sinUno($conjDuplas$)))
		FI
	}
        \noindent TAD segmento es tupla(nat, nat, nat ,nat) 
\end{tadx}
